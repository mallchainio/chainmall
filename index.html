<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChainMall - é“¾ä¸Šå•†åŸ</title>

<style>
  body { font-family: Arial,sans-serif; margin:0; background:#f5f5f5; color:#333; transition:0.3s;}
  .navbar { position:fixed; top:0; left:0; right:0; height:60px; background:#2c2c2c; color:#ff6b6b;
            display:flex; align-items:center; justify-content:space-between; padding:0 20px; font-size:20px; font-weight:bold; z-index:1000;
            box-shadow:0 2px 6px rgba(0,0,0,0.2); transition:0.3s;}
  .theme-toggle { cursor:pointer; font-size:16px; padding:5px 10px; border:1px solid #fff; border-radius:5px; background:rgba(255,255,255,0.1); transition:0.3s;}
  
  /* æ‚¬æµ®å…¬å‘Šæ  */
  .announcement { position:fixed; top:60px; left:0; right:0; height:40px; background:#ff6b6b; color:#fff; overflow:hidden; white-space:nowrap; font-size:16px; line-height:40px; z-index:999;}
  .announcement span { display:inline-block; padding-left:100%; animation:scroll-left 15s linear infinite;}
  @keyframes scroll-left { 0%{transform:translateX(0%);} 100%{transform:translateX(-100%);} }

  /* å†…å®¹åŒºå¢åŠ  padding-top é¿å…è¢«å¯¼èˆªæ å’Œå…¬å‘ŠæŒ¡ä½ */
  .content { padding:110px 20px 40px;} /* 60+40+10 = 110px */

  .loading-message { text-align:center; padding:50px 0; font-size:18px; color:#666; animation:pulse 1.5s infinite;}
  @keyframes pulse {0%{opacity:0.5}50%{opacity:1}100%{opacity:0.5}}

  .category-title { font-size:22px; font-weight:bold; margin:20px 0 10px; color:#2c2c2c; position:relative; padding-left:12px;}
  .category-title::before { content:""; position:absolute; left:0; top:0; bottom:0; width:4px; background:#2c2c2c; border-radius:2px;}

  .link-list { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:15px;}
  .link-item, .link-forum { display:flex; align-items:center; background:#fff; border-radius:12px; overflow:hidden; text-decoration:none; color:#333; transition:0.3s; padding:12px; position:relative;}
  .link-item:hover { box-shadow:0 4px 12px rgba(0,0,0,0.1);}
  .link-img { width:80px; height:80px; flex-shrink:0; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.15); margin-right:12px; background:#ccc; display:flex; align-items:center; justify-content:center; position:relative; overflow:hidden;}
  .link-img img { width:100%; height:100%; object-fit:cover; border-radius:12px; display:block;}
  .link-img .fallback-text { position:absolute; font-size:12px; font-weight:bold; color:#555; display:none; text-align:center;}
  
  .link-info { flex:1; display:flex; flex-direction:column; justify-content:space-between; position:relative; padding-right:70px;}
  .link-title { font-size:18px; font-weight:600; margin-bottom:5px; color:#ff6b6b;}
  .link-summary { font-size:14px; color:#666; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; text-overflow:ellipsis; margin-bottom:10px; padding-right:5px;}
  
  .link-price { position:absolute; top:15px; right:15px; font-weight:bold; color:#e53935; transition:0.3s;}
  .link-detail { position:absolute; bottom:1px; right:15px; font-size:16px; font-weight:bold; color:#2c2c2c; cursor:pointer; transition:0.3s;}

  .modal { display:none; position:fixed; z-index:1000; left:0;top:0;width:100%;height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;}
  .modal-content { background:#fff; padding:20px 30px; border-radius:12px; max-width:400px; width:80%; text-align:center; position:relative; transition:0.3s;}
  .modal-content a { text-decoration:none; color:#ff6b6b; font-weight:bold; transition:0.3s;}
  .modal-close { position:absolute; top:10px; right:15px; cursor:pointer; font-size:18px; font-weight:bold;}
  .footer { margin-top:40px; text-align:center; font-size:14px; color:#888;}

  /* å¤œé—´æ¨¡å¼ */
  body.dark-mode { background:#121212; color:#ddd;}
  body.dark-mode .navbar { background:#1e1e1e;}
  body.dark-mode .theme-toggle { border-color:#fff; color:#fff; background:rgba(255,255,255,0.1);}
  body.dark-mode .announcement { background:#ff6b6b; color:#fff;}
  
  /* å¤œé—´æ¨¡å¼åˆ†ç±»æ–‡å­—å’Œç«–æ¡ä¼˜åŒ– */
  body.dark-mode .category-title { color:#ffcc66;}       /* æ–‡å­—äº®è‰² */
  body.dark-mode .category-title::before { background-color:#ff6b6b;} /* ç«–æ¡ä¸»é¢˜è‰² */

  body.dark-mode .link-item, body.dark-mode .link-forum { background:#1e1e1e; color:#ddd;}
  body.dark-mode .link-title { color:#ff6b6b;}
  body.dark-mode .link-summary { color:#aaa;}
  body.dark-mode .link-price { color:#ff6b6b;}
  body.dark-mode .link-detail { color:#fff;}
  body.dark-mode .modal-content { background:#1e1e1e; color:#ddd;}
  body.dark-mode .modal-content a { color:#ff6b6b;}
  body.dark-mode .footer { color:#aaa;}
</style>
</head>
<body>

<div class="navbar">
  ChainMall é“¾ä¸Šå•†åŸ
  <span class="theme-toggle" id="themeToggle">ğŸŒ™</span>
</div>

<div class="announcement">
  <span>åŠ è½½ä¸­...</span>
</div>

<div class="content" id="productContent">
  <p class="loading-message">ğŸ›’ æ­£åœ¨åŠ è½½é“¾ä¸Šå•†å“æ•°æ®...</p>
</div>

<div class="footer">
  Â© 2026 ChainMall.meme é“¾ä¸Šå•†åŸ
  <br>
  <span id="visitorCount">ä½ æ˜¯ç¬¬ ... ä¸ªè®¿é—®æˆ‘ä»¬çš„ç½‘ç«™</span>
</div>

<div class="modal" id="detailModal">
  <div class="modal-content">
    <span class="modal-close" id="modalClose">&times;</span>
    <h3 id="modalTitle"></h3>
    <p id="modalDetail"></p>
  </div>
</div>

<script>
const productContent = document.getElementById('productContent');
const modal = document.getElementById('detailModal');
const modalTitle = document.getElementById('modalTitle');
const modalDetail = document.getElementById('modalDetail');
const modalClose = document.getElementById('modalClose');
const themeToggle = document.getElementById('themeToggle');
const annSpan = document.querySelector('.announcement span');

// è®¿é—®è®¡æ•°å™¨
fetch('https://data.ChainMall.meme/tj.php')
.then(res => res.text())
.then(data => { document.getElementById('visitorCount').textContent = `ä½ æ˜¯ç¬¬ ${data} ä¸ªè®¿é—®æˆ‘ä»¬çš„ç½‘ç«™`; })
.catch(err => console.error(err));

// åˆ›å»ºå•†å“ HTML
function createProductHTML(product){
  return `
    <a href="${product.url||'#'}" class="link-item" data-detail="${product.detail.replace(/"/g,'&quot;').replace(/\n/g,'<br>')}">
      <div class="link-img">
        <img src="${product.img_url}" alt="${product.title}">
        <span class="fallback-text">ChainMall</span>
      </div>
      <div class="link-info">
        <div>
          <div class="link-title">${product.title}</div>
          <div class="link-summary">${product.summary}</div>
        </div>
        <div>
          <div class="link-price">${product.price}</div>
          <div class="link-detail">è¯¦æƒ…</div>
        </div>
      </div>
    </a>`;
}

// æ¸²æŸ“å•†å“åˆ—è¡¨
function renderProducts(products){
  const currentLoading = document.querySelector('.loading-message');
  if(currentLoading) currentLoading.remove();

  const grouped = products.reduce((acc,p)=>{
    const cat = p.category||'æœªåˆ†ç±»';
    if(!acc[cat]) acc[cat]=[];
    acc[cat].push(p);
    return acc;
  }, {});

  let html = '';
  for(const cat in grouped){
    const listHTML = grouped[cat].map(createProductHTML).join('');
    html += `<div class="category">
               <div class="category-title">${cat}</div>
               <div class="link-list">${listHTML}</div>
             </div>`;
  }
  productContent.innerHTML = html;
  bindEvents();
}

// ç»‘å®šè¯¦æƒ…ç‚¹å‡»å’Œå›¾ç‰‡åŠ è½½å¤„ç†
function bindEvents(){
  document.querySelectorAll('.link-item, .link-forum').forEach(btn=>{
    btn.onclick = e=>{
      e.preventDefault();
      modalTitle.textContent = btn.querySelector('.link-title').textContent;
      modalDetail.innerHTML = btn.dataset.detail.replace(/&quot;/g,'"').replace(/&amp;/g,'&');
      modal.style.display='flex';
    };
  });

  document.querySelectorAll('.link-img').forEach(container=>{
    const img = container.querySelector('img');
    const text = container.querySelector('.fallback-text');
    if(img){
      img.onerror=()=>{ img.style.display='none'; if(text) text.style.display='flex'; };
      if(img.complete && img.naturalHeight===0) img.onerror();
    }
  });
}

// åŠ è½½å•†å“ + å…¬å‘Š
function loadProducts(){
  productContent.innerHTML = `<p class="loading-message">ğŸ›’ æ­£åœ¨åŠ è½½é“¾ä¸Šå•†å“æ•°æ®...</p>`;
  annSpan.textContent = 'åŠ è½½ä¸­...';
  fetch('https://data.ChainMall.meme/sp.php')
    .then(res=>res.json())
    .then(data=>{
      // å…¬å‘Š
      if(data.announcement && data.announcement.length>0){
        annSpan.innerHTML = data.announcement.map(a=>`${a.text} <a href="${a.url}">ç‚¹å‡»æŸ¥çœ‹</a>`).join(' &nbsp;|&nbsp; ');
      }

      // å•†å“
      if(Array.isArray(data.products)) renderProducts(data.products);
      else productContent.innerHTML = '<p style="text-align:center;color:red;padding:50px 0;">å•†å“æ•°æ®æ ¼å¼é”™è¯¯</p>';
    })
    .catch(err=>{
      console.error(err);
      productContent.innerHTML = '<p style="text-align:center;color:red;padding:50px 0;">æ— æ³•åŠ è½½å•†å“åˆ—è¡¨</p>';
    });
}

// é¡µé¢äº‹ä»¶
document.addEventListener('DOMContentLoaded', loadProducts);
modalClose.addEventListener('click',()=>modal.style.display='none');
window.addEventListener('click', e=>{ if(e.target===modal) modal.style.display='none'; });
themeToggle.addEventListener('click',()=>{
  document.body.classList.toggle('dark-mode');
  themeToggle.textContent = document.body.classList.contains('dark-mode') ? 'â˜€ï¸':'ğŸŒ™';
});
</script>

</body>
</html>
